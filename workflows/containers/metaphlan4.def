Bootstrap: docker
From: ubuntu:20.04
IncludeCmd: yes

%labels
  MAINTAINER Jakob Wirbel (wirbel@stanford.edu)
  VERSION v.0.0.1

%environment
export LC_ALL=C
export PATH=$PATH:/opt/software/miniconda3/bin

%post
  apt-get -y update
  apt-get install -y apt-utils software-properties-common wget
  apt-get install -y ca-certificates build-essential

  # fix this time zone stuff
  apt-get install -y add-apt-key
  export DEBIAN_FRONTEND=noninteractive
  ln -fs /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
  apt-get install -y tzdata
  dpkg-reconfigure --frontend noninteractive tzdata

  apt-get install -y python3
  python3 --version

  # conda
  mkdir -p /opt/software
  wget -q https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
  bash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/software/miniconda3
  rm -f Miniconda3-latest-Linux-x86_64.sh

  /opt/software/miniconda3/bin/conda install -y -c conda-forge -c bioconda \
    'metaphlan=4.0.4'

%runscript
    metaphlan --version
