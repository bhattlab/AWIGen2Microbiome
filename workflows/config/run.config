/* section below needs to be adjusted to local cluster */
executor {
	$slurm {
		queueSize = 30
		queue = "batch"
	}
	$local {
		cpus = 1
		memory = '4 GB'
	}
}


process {
	cache = "lenient"
	clusterOptions = "--account=asbhatt"
	withName: fastqc {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 2
		memory = {2.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: multiqc {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 1
		memory = {4.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: postfastqc {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 2
		memory = {2.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: postmultiqc {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 1
		memory = {4.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: deduplicate {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 1
		memory = {10.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: trimgalore {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 1
		memory = {10.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: hostremoval {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/preprocessing.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 4
		memory = {10.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: aggregatereports {
                executor = "slurm"
                container = "/labs/asbhatt/wirbel/utils/singularity/seaborn.sif"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 1
                memory = {10.GB * task.attempt}
                time = '24h'
                maxRetries = 3
        }
        withName: motus {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/motus.sif"
		errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
		cpus = 8
		memory = {10.GB * task.attempt}
		time = '24h'
		maxRetries = 3
	}
	withName: collate_motus {
                executor = "slurm"
                container = "/labs/asbhatt/wirbel/utils/singularity/motus.sif"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 1
                memory = {32.GB * task.attempt}
                time = '24h'
                maxRetries = 3
        }
	withName: metaphlan {
		executor = "slurm"
                container = "/labs/asbhatt/wirbel/utils/singularity/metaphlan.sif"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 8
                memory = {32.GB * task.attempt}
                time = '24h'
                maxRetries = 3
	}
	withName: collate_metaphlan {
                executor = "slurm"
                container = "/labs/asbhatt/wirbel/utils/singularity/seaborn.sif"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 1
                memory = {32.GB * task.attempt}
                time = '24h'
                maxRetries = 3
        }
	withName: megahit {
		executor = "slurm"
		container = "/labs/asbhatt/wirbel/utils/singularity/assembly.sif"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 8
                memory = {100.GB * task.attempt}
                time = '24h'
                maxRetries = 3
	}
	withName: quast {
                executor = "slurm"
                container = "/labs/asbhatt/wirbel/utils/singularity/assembly.sif"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 1
                memory = {10.GB * task.attempt}
                time = '24h'
                maxRetries = 3
        }
	withName: combine_quast {
                executor = "slurm"
                errorStrategy = {task.attempt <= 3 ? "retry" : "ignore"}
                cpus = 1
                memory = {16.GB * task.attempt}
                time = '24h'
                maxRetries = 3
        }
}

singularity {
	enabled = true
	autoMounts = true
}
